# -*- coding: utf-8 -*-
"""
K-POP Schedule Auto-Feed è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
æ—¥æœ¬èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¨­å®š
"""

import os
import locale

# æ—¥æœ¬èªãƒ­ã‚±ãƒ¼ãƒ«è¨­å®š
try:
    locale.setlocale(locale.LC_ALL, 'ja_JP.UTF-8')
except locale.Error:
    try:
        locale.setlocale(locale.LC_ALL, 'Japanese_Japan.932')
    except locale.Error:
        pass  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ã‚±ãƒ¼ãƒ«ã‚’ä½¿ç”¨

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
class Config:
    """ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚¯ãƒ©ã‚¹"""
    
    # åŸºæœ¬è¨­å®š
    DEBUG = os.getenv('DEBUG', 'False').lower() == 'true'
    TIMEZONE = 'Asia/Tokyo'
    LANGUAGE = 'ja'
    ENCODING = 'utf-8'
    
    # æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    MESSAGES = {
        'success': {
            'schedule_added': 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ­£å¸¸ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸ',
            'data_saved': 'ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ',
            'calendar_updated': 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ'
        },
        'error': {
            'invalid_input': 'å…¥åŠ›å†…å®¹ã«å•é¡ŒãŒã‚ã‚Šã¾ã™',
            'api_error': 'APIæ¥ç¶šã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
            'parse_error': 'ãƒ‡ãƒ¼ã‚¿ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ'
        },
        'info': {
            'processing': 'å‡¦ç†ä¸­...',
            'extracting': 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã‚’æŠ½å‡ºä¸­...',
            'uploading': 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...'
        }
    }

# æ—¥æœ¬èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
JAPANESE_PROMPTS = {
    'schedule_extraction': """
ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰K-POPã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

æŠ½å‡ºå¯¾è±¡ï¼š
- æ—¥ä»˜ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
- æ™‚é–“ï¼ˆHH:MMå½¢å¼ã€ä¸æ˜ã®å ´åˆã¯ç©ºæ¬„ï¼‰
- ã‚¤ãƒ™ãƒ³ãƒˆå
- ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå
- ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥ï¼ˆã‚³ãƒ³ã‚µãƒ¼ãƒˆã€ãƒªãƒªãƒ¼ã‚¹ã€ãƒ†ãƒ¬ãƒ“å‡ºæ¼”ãªã©ï¼‰
- å ´æ‰€ï¼ˆè¨˜è¼‰ãŒã‚ã‚‹å ´åˆï¼‰

ãƒ†ã‚­ã‚¹ãƒˆï¼š
{text}

JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
```json
{{
    "events": [
        {{
            "date": "YYYY-MM-DD",
            "time": "HH:MM",
            "title": "ã‚¤ãƒ™ãƒ³ãƒˆå",
            "artist": "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå",
            "type": "ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥",
            "location": "å ´æ‰€"
        }}
    ]
}}
```
""",

    'data_validation': """
ä»¥ä¸‹ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

ãƒ‡ãƒ¼ã‚¿ï¼š
{data}

ç¢ºèªé …ç›®ï¼š
1. æ—¥ä»˜å½¢å¼ãŒæ­£ã—ã„ã‹
2. å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹
3. é‡è¤‡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„ã‹

å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ä¿®æ­£æ¡ˆã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚
""",

    'calendar_description': """
{artist}ã®{event_type}ã€Œ{title}ã€

ğŸ“… æ—¥æ™‚: {date} {time}
ğŸ“ å ´æ‰€: {location}
ğŸµ ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ: {artist}

â€»ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯è‡ªå‹•åé›†ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šè¿½åŠ ã•ã‚Œã¾ã—ãŸ
"""
}

# æ±ç”¨ã‚¸ãƒ£ãƒ³ãƒ«å¯¾å¿œ æ”¹è‰¯ç‰ˆGeminiä¿¡é ¼æ€§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
UNIVERSAL_SCHEDULE_PROMPT_TEMPLATE = """
ä»¥ä¸‹ã®æ¤œç´¢çµæœã‹ã‚‰ã€{artist_name}ã®ä¿¡é ¼æ€§ã®é«˜ã„{genre}ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã®ã¿ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

ã€æ±ç”¨ä¿¡é ¼æ€§åˆ¤å®šåŸºæº–ã€‘
é«˜ä¿¡é ¼åº¦ï¼š
- å…¬å¼ã‚µã‚¤ãƒˆï¼ˆã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»ãƒ¬ãƒ¼ãƒ™ãƒ«ãƒ»äº‹å‹™æ‰€ã®å…¬å¼ã‚µã‚¤ãƒˆï¼‰
- å¤§æ‰‹ãƒ¡ãƒ‡ã‚£ã‚¢ï¼ˆæ–°èç¤¾ã€ãƒ†ãƒ¬ãƒ“å±€ã€éŸ³æ¥½å°‚é–€ãƒ¡ãƒ‡ã‚£ã‚¢ï¼‰
- å…¬å¼ãƒã‚±ãƒƒãƒˆã‚µã‚¤ãƒˆï¼ˆe+ã€ãƒã‚±ãƒƒãƒˆã´ã‚ã€ãƒ­ãƒ¼ã‚½ãƒ³ãƒã‚±ãƒƒãƒˆã€ã‚¤ãƒ¼ãƒ—ãƒ©ã‚¹ãªã©ï¼‰
- æ”¿åºœãƒ»è‡ªæ²»ä½“ã®å…¬å¼ç™ºè¡¨
- èªè¨¼æ¸ˆã¿å…¬å¼SNSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- ç¢ºç«‹ã•ã‚ŒãŸéŸ³æ¥½ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆæƒ…å ±ã‚µã‚¤ãƒˆ

ä½ä¿¡é ¼åº¦ï¼ˆç„¡è¦–ã™ã‚‹ï¼‰ï¼š
- å€‹äººãƒ–ãƒ­ã‚°ãƒ»ã¾ã¨ã‚ã‚µã‚¤ãƒˆãƒ»ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚µã‚¤ãƒˆ
- ã€Œã€œã‹ã‚‚ã€ã€Œã€œã‚‰ã—ã„ã€ã€Œå™‚ã€ã€Œäºˆæƒ³ã€ã€Œãƒªãƒ¼ã‚¯ã€ã€Œæ†¶æ¸¬ã€ã‚’å«ã‚€æŠ•ç¨¿
- åŒ¿åæ²ç¤ºæ¿ãƒ»SNSã®éå…¬å¼æŠ•ç¨¿
- ã€Œæœªç¢ºèªã€ã€Œæƒ…å ±å¾…ã¡ã€ã€Œãƒ•ã‚¡ãƒ³ã®äºˆæƒ³ã€ã‚’å«ã‚€æƒ…å ±
- Wikiã‚µã‚¤ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ©ãƒ ãƒ»Q&Aã‚µã‚¤ãƒˆ

ã€æŠ½å‡ºãƒ«ãƒ¼ãƒ«ã€‘
1. æ˜ç¢ºãªæ—¥ä»˜ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã¿
2. éå»ã®æ—¥ä»˜ã¯é™¤å¤–
3. ä¿¡é ¼åº¦0.7æœªæº€ã®æƒ…å ±ã¯é™¤å¤–
4. é‡è¤‡ã™ã‚‹æƒ…å ±ã¯ä¿¡é ¼åº¦ã®é«˜ã„ã‚‚ã®ã‚’å„ªå…ˆ
5. {artist_name}ã«é–¢é€£ã—ãªã„ã‚¤ãƒ™ãƒ³ãƒˆã¯é™¤å¤–
6. {genre}ã‚¸ãƒ£ãƒ³ãƒ«ã«é©åˆã—ãªã„æƒ…å ±ã¯é™¤å¤–

ã€æ¤œç´¢çµæœã€‘
{search_results}

ã€å‡ºåŠ›å½¢å¼ã€‘
ä»¥ä¸‹ã®JSONå½¢å¼ã§ã®ã¿å›ç­”ã—ã¦ãã ã•ã„ã€‚ä»–ã®æ–‡ç« ã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚

{{
    "events": [
        {{
            "date": "YYYY-MM-DD",
            "time": "HH:MM",
            "title": "ã‚¤ãƒ™ãƒ³ãƒˆå",
            "artist": "{artist_name}",
            "type": "ã‚³ãƒ³ã‚µãƒ¼ãƒˆ|ãƒªãƒªãƒ¼ã‚¹|ãƒ†ãƒ¬ãƒ“å‡ºæ¼”|ãƒ©ã‚¸ã‚ªå‡ºæ¼”|ã‚¤ãƒ™ãƒ³ãƒˆ|ãƒ•ã‚¡ãƒ³ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°|ãã®ä»–",
            "location": "é–‹å‚¬å ´æ‰€",
            "source": "https://...",
            "confidence": 0.9,
            "reliability": "high|medium|low",
            "genre": "{genre}"
        }}
    ]
}}

ä¿¡é ¼æ€§ãŒä½ã„å ´åˆã‚„è©²å½“ã™ã‚‹æƒ…å ±ãŒãªã„å ´åˆã¯ã€ç©ºã®é…åˆ—ã‚’è¿”ã—ã¦ãã ã•ã„ï¼š
{{
    "events": []
}}
"""

# K-POPå°‚ç”¨ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
JAPANESE_SCHEDULE_PROMPT_TEMPLATE = """
ä»¥ä¸‹ã®æ¤œç´¢çµæœã‹ã‚‰ã€{artist_name}ã®ä¿¡é ¼æ€§ã®é«˜ã„K-POPã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã®ã¿ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

ã€ä¿¡é ¼æ€§åˆ¤å®šåŸºæº–ã€‘
é«˜ä¿¡é ¼åº¦ï¼š
- å…¬å¼ã‚µã‚¤ãƒˆï¼ˆ.comã€.jpã€.krç­‰ã§ã€Œofficialã€ã€Œartiståã€ã‚’å«ã‚€ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
- å¤§æ‰‹ãƒ¡ãƒ‡ã‚£ã‚¢ï¼ˆNHKã€æœæ—¥æ–°èã€éŸ³æ¥½ãƒŠã‚¿ãƒªãƒ¼ã€Billboard JAPANãªã©ï¼‰
- å…¬å¼ãƒã‚±ãƒƒãƒˆã‚µã‚¤ãƒˆï¼ˆe+ã€ãƒã‚±ãƒƒãƒˆã´ã‚ã€ãƒ­ãƒ¼ã‚½ãƒ³ãƒã‚±ãƒƒãƒˆã€ã‚¤ãƒ¼ãƒ—ãƒ©ã‚¹ãªã©ï¼‰
- è¡Œæ”¿æ©Ÿé–¢ã®ç™ºè¡¨
- å…¬å¼SNSã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆèªè¨¼æ¸ˆã¿ï¼‰

ä½ä¿¡é ¼åº¦ï¼ˆç„¡è¦–ã™ã‚‹ï¼‰ï¼š
- å€‹äººãƒ–ãƒ­ã‚°ãƒ»ã¾ã¨ã‚ã‚µã‚¤ãƒˆ
- ã€Œã€œã‹ã‚‚ã€ã€Œã€œã‚‰ã—ã„ã€ã€Œå™‚ã€ã€Œäºˆæƒ³ã€ã€Œãƒªãƒ¼ã‚¯ã€ã‚’å«ã‚€æŠ•ç¨¿
- åŒ¿åæ²ç¤ºæ¿ãƒ»SNSã®éå…¬å¼æŠ•ç¨¿
- ã€Œæœªç¢ºèªã€ã€Œæƒ…å ±å¾…ã¡ã€ã‚’å«ã‚€æƒ…å ±
- ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆã®æ¨æ¸¬ãƒ»äºˆæƒ³è¨˜äº‹

ã€æŠ½å‡ºãƒ«ãƒ¼ãƒ«ã€‘
1. æ˜ç¢ºãªæ—¥ä»˜ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã¿
2. éå»ã®æ—¥ä»˜ã¯é™¤å¤–
3. ä¿¡é ¼åº¦0.7æœªæº€ã®æƒ…å ±ã¯é™¤å¤–
4. é‡è¤‡ã™ã‚‹æƒ…å ±ã¯ä¿¡é ¼åº¦ã®é«˜ã„ã‚‚ã®ã‚’å„ªå…ˆ
5. {artist_name}ã«é–¢é€£ã—ãªã„ã‚¤ãƒ™ãƒ³ãƒˆã¯é™¤å¤–

ã€æ¤œç´¢çµæœã€‘
{search_results}

ã€å‡ºåŠ›å½¢å¼ã€‘
ä»¥ä¸‹ã®JSONå½¢å¼ã§ã®ã¿å›ç­”ã—ã¦ãã ã•ã„ã€‚ä»–ã®æ–‡ç« ã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚

{{
    "events": [
        {{
            "date": "YYYY-MM-DD",
            "time": "HH:MM",
            "title": "ã‚¤ãƒ™ãƒ³ãƒˆå",
            "artist": "{artist_name}",
            "type": "ã‚³ãƒ³ã‚µãƒ¼ãƒˆ|ãƒªãƒªãƒ¼ã‚¹|ãƒ†ãƒ¬ãƒ“å‡ºæ¼”|ãƒ©ã‚¸ã‚ªå‡ºæ¼”|ã‚¤ãƒ™ãƒ³ãƒˆ|ãƒ•ã‚¡ãƒ³ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°|ãã®ä»–",
            "location": "é–‹å‚¬å ´æ‰€",
            "source": "https://...",
            "confidence": 0.9,
            "reliability": "high|medium|low"
        }}
    ]
}}

ä¿¡é ¼æ€§ãŒä½ã„å ´åˆã‚„è©²å½“ã™ã‚‹æƒ…å ±ãŒãªã„å ´åˆã¯ã€ç©ºã®é…åˆ—ã‚’è¿”ã—ã¦ãã ã•ã„ï¼š
{{
    "events": []
}}
"""

def get_message(category: str, key: str) -> str:
    """æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—"""
    return Config.MESSAGES.get(category, {}).get(key, f"{category}.{key}")

def get_prompt(prompt_name: str, **kwargs) -> str:
    """æ—¥æœ¬èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—"""
    template = JAPANESE_PROMPTS.get(prompt_name, "")
    return template.format(**kwargs)